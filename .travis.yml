# language: python

# python:
#   - "3.6"

# cache:
#   directories:
#     - /home/travis/build/louiscklaw/ubuntu_respin/origin

# install:
#   - sudo apt update && sudo apt install -y git wget genisoimage bc squashfs-tools xorriso
#   - pip3 install pipenv
#   - pipenv install pip==18 fabric3 pychalk

# script:
#   - pipenv run fab helloworld

# https://docs.travis-ci.com/user/docker/

dist: bionic

services:
  - docker

before_install:
  - docker --version
  - bash ./scripts/docker-build-image.sh

jobs:
  include:
    - stage: Build
      name: "build image"

      # before_install:
      #   # extract google_drive_credentials.json
      #   - cd $TRAVIS_BUILD_DIR
      #   - openssl aes-256-cbc -K $encrypted_222ad43b3e68_key -iv $encrypted_222ad43b3e68_iv -in google_drive_credentials.json.enc -out ./google_drive_credentials.json -d
      #   - export GOOGLE_APPLICATION_CREDENTIALS=$TRAVIS_BUILD_DIR/google_drive_credentials.json
      #   - cd -

      #   - cd $TRAVISBUILD_DIR
      #   - openssl aes-256-cbc -K $encrypted_504c2998e539_key -iv $encrypted_504c2998e539_iv -in id_rsa.enc -out ./sshkeys/id_rsa -d
      #   - cd -

      script:
        - bash scripts/build_all.sh
        - touch $TRAVIS_BUILD_DIR/destination/linuxium-v5.6-ubuntu-18.04.4-desktop-amd64.iso
        - ls -lh $TRAVIS_BUILD_DIR/destination/linuxium-v5.6-ubuntu-18.04.4-desktop-amd64.iso
        - cd $TRAVIS_BUILD_DIR/_utils
        - sudo apt update
        - sudo apt install -y p7zip-full curl
        - sudo apt install -y python3 python3-pip python3-dev python3-wheel python3-setuptools
        - pip3 install --user pipenv
        - pipenv sync
        # - pipenv run gupload --to 10dvhpYObvGfnr0-RXlQIQHs9sI-451Ru -f linuxium-v5.6-ubuntu-18.04.4-desktop-amd64.iso $TRAVIS_BUILD_DIR/destination/linuxium-v5.6-ubuntu-18.04.4-desktop-amd64.iso
        - cd ..

stages:
  - Build
  - Merge
